import{Q as U}from"./QInput-KGKLjW_g.js";import{Q as L}from"./QFile-Cbq9vc55.js";import{Q as O}from"./QCheckbox-ab-QeTIl.js";import{v as M,Q as T}from"./QBtn-Biy0hJ3O.js";import{c as _,r as g,p as $,q as G,o as J,g as K,h as X,V as N,d as Y,s as Z,a9 as H,a as W,G as Q,y as B,E as I,D as p,z as ee,aa as te,F as oe,A as ae}from"./index-Be8ChGiU.js";import{f as re}from"./use-key-composition-Ciw9u5mC.js";import{h as le}from"./QIcon-CA-t86hN.js";import"./private.use-form-DYEkI5C-.js";import"./QChip-k6UDb--B.js";import"./use-checkbox-CHr9NwHg.js";const se=_({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(v,{slots:b,emit:c}){const x=K(),n=g(null);let i=0;const u=[];function d(t){const r=typeof t=="boolean"?t:v.noErrorFocus!==!0,e=++i,o=(a,l)=>{c(`validation${a===!0?"Success":"Error"}`,l)},V=a=>{const l=a.validate();return typeof l.then=="function"?l.then(s=>({valid:s,comp:a}),s=>({valid:!1,comp:a,err:s})):Promise.resolve({valid:l,comp:a})};return(v.greedy===!0?Promise.all(u.map(V)).then(a=>a.filter(l=>l.valid!==!0)):u.reduce((a,l)=>a.then(()=>V(l).then(s=>{if(s.valid===!1)return Promise.reject(s)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return e===i&&o(!0),!0;if(e===i){const{comp:l,err:s}=a[0];if(s!==void 0&&console.error(s),o(!1,l),r===!0){const m=a.find(({comp:f})=>typeof f.focus=="function"&&M(f.$)===!1);m!==void 0&&m.comp.focus()}}return!1})}function P(){i++,u.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function q(t){t!==void 0&&N(t);const r=i+1;d().then(e=>{r===i&&e===!0&&(v.onSubmit!==void 0?c("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function E(t){t!==void 0&&N(t),c("reset"),Y(()=>{P(),v.autofocus===!0&&v.noResetFocus!==!0&&w()})}function w(){re(()=>{if(n.value===null)return;const t=n.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||n.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||n.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(n.value.querySelectorAll("[tabindex]"),r=>r.tabIndex!==-1);t?.focus({preventScroll:!0})})}Z(H,{bindComponent(t){u.push(t)},unbindComponent(t){const r=u.indexOf(t);r!==-1&&u.splice(r,1)}});let F=!1;return $(()=>{F=!0}),G(()=>{F===!0&&v.autofocus===!0&&w()}),J(()=>{v.autofocus===!0&&w()}),Object.assign(x.proxy,{validate:d,resetValidation:P,submit:q,reset:E,focus:w,getValidationComponents:()=>u}),()=>X("form",{class:"q-form",ref:n,onSubmit:q,onReset:E},le(b.default))}}),ne={class:"text-primary text-center q-pa-md flex flex-center"},ie={key:0,class:"q-mt-md"},ue=["src"],de={key:1,class:"q-mt-md",style:{"max-width":"200px","max-height":"200px",border:"2px dashed #ccc",display:"flex","justify-content":"center","align-items":"center","font-size":"14px",color:"#aaa"}},ce={class:"text-h6",style:{opacity:".4"}},Ve={__name:"SignupPage",setup(v){const b=g(""),c=g(""),x=g(""),n=g(""),i=g(!1),u=g(null),d=g(null),P=W(()=>c.value!==x.value),q=ae(),E=(r,e=180,o=180,V=40)=>new Promise((R,a)=>{const l=new FileReader;l.onload=s=>{const m=new Image;m.src=s.target.result,m.onload=()=>{const f=document.createElement("canvas"),j=f.getContext("2d");let h=m.width,y=m.height;h>y?h>e&&(y*=e/h,h=e):y>o&&(h*=o/y,y=o),f.width=h,f.height=y,j.drawImage(m,0,0,h,y);const z=S=>new Promise((k,C)=>{f.toBlob(A=>{if(!A){C(new Error("Failed to compress image."));return}if(A.size/1024<=V)k(A);else{const D=S-.1;D>=.1?z(D).then(k).catch(C):C(new Error("Unable to compress image below the specified size."))}},"image/jpeg",S)});z(.9).then(S=>R(S)).catch(S=>a(S))},m.onerror=f=>{a(f)}},l.onerror=s=>{a(s)},l.readAsDataURL(r)}),w=async r=>{if(r)try{const e=await E(r),o=new FileReader;o.onload=V=>{d.value=V.target.result},o.readAsDataURL(e)}catch(e){console.error("Error resizing image:",e),alert("Failed to resize image. Please try again.")}else d.value=""},F=()=>{d.value&&(localStorage.setItem("uploadedImage",d.value),console.log("Image saved to local storage."))},t=()=>{if(!P.value){console.log({email:b.value,password:c.value,passwordConfirm:x.value,username:n.value,termsAccepted:i.value,profilePicture:d.value});var r={email:b.value,password:c.value,username:n.value};fetch("https://vibemapbe.com/auth/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(e=>e.ok?e.json():e.json().then(o=>{throw new Error(o.message||"Signup failed")})).then(e=>{alert("Signup successful. Please login to continue."),console.log("Signup successful:",e),q.push("/profile"),F()}).catch(e=>{console.error("Signup error:",e),alert("Signup failed. Please try again. Error: "+e.message)})}};return(r,e)=>(B(),Q("div",ne,[I("div",null,[e[7]||(e[7]=I("div",{class:"text-h5"},"Signup Page",-1)),p(se,{class:"q-gutter-md signup-form",onSubmit:te(t,["prevent"])},{default:ee(()=>[p(U,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),label:"Username",filled:"",required:""},null,8,["modelValue"]),p(L,{modelValue:u.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>u.value=o),w],label:"Upload Profile Picture",filled:"",accept:"image/*","max-files":1},null,8,["modelValue"]),d.value?(B(),Q("div",ie,[I("img",{src:d.value,alt:"Profile Preview",class:"q-mb-md",style:{"max-width":"200px","max-height":"200px","object-fit":"cover"}},null,8,ue)])):(B(),Q("div",de," No Image Uploaded ")),p(U,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),label:"Email Address",type:"email",filled:"",required:""},null,8,["modelValue"]),p(U,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),label:"Password",type:"password",filled:"",required:""},null,8,["modelValue"]),p(U,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=o=>x.value=o),label:"Confirm Password",type:"password",filled:"",required:"",error:P.value,"error-message":"Passwords do not match"},null,8,["modelValue","error"]),p(O,{modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value=o),label:"I agree to the Terms of Use",required:""},null,8,["modelValue"]),p(T,{label:"Sign Up",color:"primary",type:"submit",unelevated:"",class:"q-mt-md"})]),_:1}),I("div",ce,[e[6]||(e[6]=oe(" Already have an account? ")),p(T,{flat:"",to:"/profile",label:"Login"})])])]))}};export{Ve as default};
