import{a as T,Q as C}from"./QInput-Bmzt1o1W.js";import{Q as M}from"./QFile-CYGu8_hc.js";import{Q as j,h as D}from"./QIcon-CZv0_1RH.js";import{c as R,h as w,a as z,r as b,B as L,C as O,o as $,g as K,z as Q,d as J,E as G,$ as H,T as F,K as U,R as E,Q as p,L as X,a0 as Y,S as Z,M as W}from"./index-D-Ce-gIF.js";import{u as ee,a as oe,b as te}from"./use-checkbox-DooYTIMl.js";import{a as ae,Q as B}from"./QBtn-CP9xNQzl.js";import"./use-dark-D-6dY4zH.js";import"./private.use-form-BoUSJaTx.js";const le=()=>w("div",{key:"svg",class:"q-checkbox__bg absolute"},[w("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[w("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),w("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]),se=R({name:"QCheckbox",props:oe,emits:ee,setup(u){const g=le();function d(h,r){const n=z(()=>(h.value===!0?u.checkedIcon:r.value===!0?u.indeterminateIcon:u.uncheckedIcon)||null);return()=>n.value!==null?[w("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[w(j,{class:"q-checkbox__icon",name:n.value})])]:[g]}return te("checkbox",d)}}),re=R({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(u,{slots:g,emit:d}){const h=K(),r=b(null);let n=0;const m=[];function c(o){const l=typeof o=="boolean"?o:u.noErrorFocus!==!0,e=++n,t=(a,s)=>{d(`validation${a===!0?"Success":"Error"}`,s)},P=a=>{const s=a.validate();return typeof s.then=="function"?s.then(i=>({valid:i,comp:a}),i=>({valid:!1,comp:a,err:i})):Promise.resolve({valid:s,comp:a})};return(u.greedy===!0?Promise.all(m.map(P)).then(a=>a.filter(s=>s.valid!==!0)):m.reduce((a,s)=>a.then(()=>P(s).then(i=>{if(i.valid===!1)return Promise.reject(i)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return e===n&&t(!0),!0;if(e===n){const{comp:s,err:i}=a[0];if(i!==void 0&&console.error(i),t(!1,s),l===!0){const f=a.find(({comp:v})=>typeof v.focus=="function"&&ae(v.$)===!1);f!==void 0&&f.comp.focus()}}return!1})}function S(){n++,m.forEach(o=>{typeof o.resetValidation=="function"&&o.resetValidation()})}function q(o){o!==void 0&&Q(o);const l=n+1;c().then(e=>{l===n&&e===!0&&(u.onSubmit!==void 0?d("submit",o):o!==void 0&&o.target!==void 0&&typeof o.target.submit=="function"&&o.target.submit())})}function k(o){o!==void 0&&Q(o),d("reset"),J(()=>{S(),u.autofocus===!0&&u.noResetFocus!==!0&&V()})}function V(){T(()=>{if(r.value===null)return;const o=r.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||r.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||r.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(r.value.querySelectorAll("[tabindex]"),l=>l.tabIndex!==-1);o?.focus({preventScroll:!0})})}G(H,{bindComponent(o){m.push(o)},unbindComponent(o){const l=m.indexOf(o);l!==-1&&m.splice(l,1)}});let I=!1;return L(()=>{I=!0}),O(()=>{I===!0&&u.autofocus===!0&&V()}),$(()=>{u.autofocus===!0&&V()}),Object.assign(h.proxy,{validate:c,resetValidation:S,submit:q,reset:k,focus:V,getValidationComponents:()=>m}),()=>w("form",{class:"q-form",ref:r,onSubmit:q,onReset:k},D(g.default))}}),ne={class:"text-primary text-center q-pa-md flex flex-center"},ie={key:0,class:"q-mt-md"},ue=["src"],de={key:1,class:"q-mt-md",style:{"max-width":"200px","max-height":"200px",border:"2px dashed #ccc",display:"flex","justify-content":"center","align-items":"center","font-size":"14px",color:"#aaa"}},ce={class:"text-h6",style:{opacity:".4"}},me="",we={__name:"SignupPage",setup(u){const g=b(""),d=b(""),h=b(""),r=b(""),n=b(!1),m=b(null),c=b(null),S=z(()=>d.value!==h.value),q=W(),k=(l,e=180,t=180,P=.8)=>new Promise((_,a)=>{const s=new FileReader;s.onload=i=>{const f=new Image;f.src=i.target.result,f.onload=()=>{const v=document.createElement("canvas"),N=v.getContext("2d");let x=f.width,y=f.height;x>y?x>e&&(y*=e/x,x=e):y>t&&(x*=t/y,y=t),v.width=x,v.height=y,N.drawImage(f,0,0,x,y),v.toBlob(A=>{if(!A){a(new Error("Failed to resize image."));return}_(A)},"image/jpeg",P)},f.onerror=v=>{a(v)}},s.onerror=i=>{a(i)},s.readAsDataURL(l)}),V=async l=>{if(l)try{const e=await k(l),t=new FileReader;t.onload=P=>{c.value=P.target.result},t.readAsDataURL(e)}catch(e){console.error("Error resizing image:",e),alert("Failed to resize image. Please try again.")}else c.value=""},I=()=>{c.value&&(localStorage.setItem("uploadedImage",c.value),console.log("Image saved to local storage."))},o=()=>{if(!S.value){console.log({email:g.value,password:d.value,passwordConfirm:h.value,username:r.value,termsAccepted:n.value,profilePicture:c.value});var l={email:g.value,password:d.value,username:r.value,profilePicture:c.value};fetch("https://vibemapbe.com/auth/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(e=>e.json()).then(e=>{me.status!=200?(alert(e),q.push("/profile")):(console.log("Signup successful:",e),q.push("/"),I())}).catch(e=>{console.error("Signup error:",e),alert("Signup failed. Please try again. Error: "+e)})}};return(l,e)=>(U(),F("div",ne,[E("div",null,[e[7]||(e[7]=E("div",{class:"text-h5"},"Signup Page",-1)),p(re,{class:"q-gutter-md signup-form",onSubmit:Y(o,["prevent"])},{default:X(()=>[p(C,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),label:"Username",filled:"",required:""},null,8,["modelValue"]),p(M,{modelValue:m.value,"onUpdate:modelValue":[e[1]||(e[1]=t=>m.value=t),V],label:"Upload Profile Picture",filled:"",accept:"image/*","max-files":1,onAdded:l.previewImage},null,8,["modelValue","onAdded"]),c.value?(U(),F("div",ie,[E("img",{src:c.value,alt:"Profile Preview",class:"q-mb-md",style:{"max-width":"200px","max-height":"200px","object-fit":"cover"}},null,8,ue)])):(U(),F("div",de," No Image Uploaded ")),p(C,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),label:"Email Address",type:"email",filled:"",required:""},null,8,["modelValue"]),p(C,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value=t),label:"Password",type:"password",filled:"",required:""},null,8,["modelValue"]),p(C,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=t=>h.value=t),label:"Confirm Password",type:"password",filled:"",required:"",error:S.value,"error-message":"Passwords do not match"},null,8,["modelValue","error"]),p(se,{modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value=t),label:"I agree to the Terms of Use",required:""},null,8,["modelValue"]),p(B,{label:"Sign Up",color:"primary",type:"submit",unelevated:"",class:"q-mt-md"})]),_:1}),E("div",ce,[e[6]||(e[6]=Z(" Already have an account? ")),p(B,{flat:"",to:"/profile",label:"Login"})])])]))}};export{we as default};
