import{a as A,Q as L,_ as N,c as j,b as f}from"./agos-profile-kpYc6FFD.js";import{Q as i}from"./QItem-DiZJodSc.js";import{Q as V}from"./QSeparator-CgohuqIJ.js";import{Q as E}from"./QInput-oeDU01AV.js";import{Q as h,R as S}from"./QBtn-Cd32oUfA.js";import{Q as z}from"./QFile-CvJacwZn.js";import{Q as y}from"./QIcon-LmRpt4bQ.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as x,K as r,O as o,L as a,r as n,o as F,V as g,T as _,R as p,k as b,U as O,J as v,W as C,Q as P}from"./index-C95LXPJp.js";import"./use-dark-CdS84_Nq.js";import"./private.use-form-CynPjj_t.js";const R={setup(){const d=n([{username:"User",userId:1,email:"email@email.com",picture:"../assets/vibemap-logo.svg",token:"password"}]),e=n(null),k=n(!0),l=n(""),u=n(!1),c=n(""),s=n(""),I=n(""),Q=localStorage.getItem("authToken");F(()=>{k.value=localStorage.getItem("isLoggedIn")==="true",l.value=localStorage.getItem("loggedInId"),I.value=localStorage.getItem("usertoken"),console.log(I.value),T(Q)});const T=async w=>{console.log(w);try{const t=await fetch("https://vibemapbe.com/auth/auth/me",{method:"GET",headers:{Authorization:`Bearer ${w}`}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const m=await t.json();d.value[0]={...d.value[0],email:m.email,userId:m.id}}catch(t){e.value=t.message||"Failed to fetch user data"}},q=async()=>{if(c.value&&s.value){const w={email:c.value,password:s.value};try{const t=await fetch("https://vibemapbe.com/auth/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(t.ok){k.value=!0,localStorage.setItem("isLoggedIn","true");const m=await t.json();console.log(m),I.value=m.access_token,localStorage.setItem("usertoken",m.access_token),this.$router.push("/"),alert("Login successful! Welcome back "+c.value)}else console.error("Login failed",t.responseText),alert("Login failed",t.responseText)}catch(t){console.error("Error during login",t)}}else console.error("Email and password are required"),alert("Email and password are required")},U=()=>{k.value=!1,localStorage.setItem("isLoggedIn","false"),localStorage.setItem("loggedInId",null),c.value="",s.value="",B()},B=()=>{location.reload()};return{login:q,logout:U,editProfile:()=>{u.value=!0,console.log(u.value)},saveProfile:()=>{u.value=!1,console.log(u.value)},profileEdit:u,email:c,password:s,isLoggedIn:k,loggedInId:l,userInfo:d}}},W={class:"text-primary text-center q-pa-md flex flex-center w-100"},J={class:"q-mt-md text-h6"},G={class:"text-caption text-grey"};function H(d,e,k,l,u,c){return r(),x("div",W,[o(A,{class:"w-100"},{default:a(()=>[l.isLoggedIn?g("",!0):(r(),x(_,{key:0},[o(i,{class:"q-pa-md column items-center w-100"},{default:a(()=>[o(L,{size:"72px"},{default:a(()=>e[3]||(e[3]=[p("img",{src:N,alt:"User Avatar"},null,-1)])),_:1}),e[4]||(e[4]=p("div",{class:"q-mt-md text-h6"},"Welcome",-1)),e[5]||(e[5]=p("div",{class:"text-caption text-grey"},"Please login or sign up",-1))]),_:1}),o(V),o(i,{class:"w-100"},{default:a(()=>[o(E,{modelValue:l.email,"onUpdate:modelValue":e[0]||(e[0]=s=>l.email=s),label:"Email",type:"email",filled:"",class:"full-width"},null,8,["modelValue"])]),_:1}),o(i,{class:"w-100"},{default:a(()=>[o(E,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=s=>l.password=s),label:"Password",type:"password",filled:"",class:"full-width"},null,8,["modelValue"])]),_:1}),o(i,{class:"q-gutter-sm w-100"},{default:a(()=>[o(h,{label:"Login",color:"primary",class:"col-6",onClick:l.login},null,8,["onClick"]),o(h,{label:"Signup",color:"secondary",outline:"",class:"col-6",to:"./signup"})]),_:1})],64)),l.isLoggedIn?(r(),x(_,{key:1},[(r(!0),x(_,null,O(l.userInfo,(s,I)=>(r(),v(i,{class:"q-pa-md column items-center w-100",key:I},{default:a(()=>[o(L,{size:"160px"},{default:a(()=>[e[6]||(e[6]=p("img",{src:j,alt:"User Avatar"},null,-1)),l.profileEdit?(r(),v(z,{key:0,class:"picture-edit",modelValue:d.profilePicture,"onUpdate:modelValue":e[2]||(e[2]=Q=>d.profilePicture=Q),filled:"",accept:"image/*","max-files":1,onAdded:d.previewImage},null,8,["modelValue","onAdded"])):g("",!0),l.profileEdit?(r(),v(y,{key:1,class:"picture-edit-icon",name:"edit"})):g("",!0)]),_:1}),p("div",J,C(s.username),1),p("div",G,C(s.email),1)]),_:2},1024))),128)),o(V),l.profileEdit?g("",!0):b((r(),v(i,{key:0,clickable:"",class:"",onClick:l.editProfile},{default:a(()=>[o(f,{avatar:""},{default:a(()=>[o(y,{name:"edit"})]),_:1}),o(f,null,{default:a(()=>e[7]||(e[7]=[P("Edit profile")])),_:1})]),_:1},8,["onClick"])),[[S]]),l.profileEdit?b((r(),v(i,{key:1,clickable:"",class:"",onClick:l.saveProfile},{default:a(()=>[o(f,{avatar:""},{default:a(()=>[o(y,{name:"save"})]),_:1}),o(f,null,{default:a(()=>e[8]||(e[8]=[P("Save profile")])),_:1})]),_:1},8,["onClick"])),[[S]]):g("",!0),b((r(),v(i,{clickable:"",class:"text-red",onClick:l.logout},{default:a(()=>[o(f,{avatar:""},{default:a(()=>[o(y,{name:"logout",color:"red"})]),_:1}),o(f,null,{default:a(()=>e[9]||(e[9]=[P("Logout")])),_:1})]),_:1},8,["onClick"])),[[S]])],64)):g("",!0)]),_:1})])}const ie=D(R,[["render",H]]);export{ie as default};
