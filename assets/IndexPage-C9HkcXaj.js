import{u as I,b as M,Q as h}from"./QBtn-B7Tz8TDH.js";import{Q as S}from"./QRating-BowyChWF.js";import{Q as k}from"./QInput-C3ObMMsO.js";import{Q as v,a as C}from"./QCard-CU87xT_P.js";import{c as _,a as L,h as Q,J as c,K as d,L as i,r as s,o as V,e as N,R as m,O as n,V as w}from"./index-DP65yI-g.js";import{h as O}from"./QIcon-B7FjSq0B.js";import{Q as J}from"./QItem-CsH1Q2jI.js";import{Q as P}from"./QPage-CAkfjQhZ.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./private.use-form-C52ctRGH.js";import"./use-dark-r1MK6As8.js";const R=_({name:"QCardActions",props:{...I,vertical:Boolean},setup(e,{slots:t}){const o=M(e),a=L(()=>`q-card__actions ${o.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>Q("div",{class:a.value},O(t.default))}}),z={data(){return{map:null,userMarker:null}},mounted(){this.loadGoogleMaps()},methods:{loadGoogleMaps(){if(window.google&&window.google.maps){this.initMap();return}const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCa6szZqcobw9AEf8KiqXUDpAoLgSR6v7A",e.async=!0,e.defer=!0,e.onload=()=>this.initMap(),document.head.appendChild(e)},initMap(){if(!navigator.geolocation)return console.error("Geolocation is not supported by this browser."),this.loadDefaultLocation();this.map=new window.google.maps.Map(document.getElementById("map"),{center:{lat:52.377956,lng:4.89707},zoom:12,mapTypeControl:!1,zoomControl:!1,cameraControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,gestureHandling:"greedy"}),this.loadHeatmap(),this.trackUserLocation()},trackUserLocation(){let e=!0;navigator.geolocation.watchPosition(t=>{const o={lat:t.coords.latitude,lng:t.coords.longitude};e&&(this.map.setCenter(o),this.map.setZoom(15),e=!1),this.userMarker?this.userMarker.setPosition(o):this.userMarker=new window.google.maps.Marker({position:o,map:this.map,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff"}})},()=>{console.error("User denied Geolocation."),this.loadDefaultLocation()},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},recenterMap(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};this.map.setCenter(t),this.map.setZoom(15),this.userMarker||(this.userMarker=new window.google.maps.Marker({position:t,map:this.map,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff"}}))},()=>{console.error("Unable to retrieve location.")}):console.error("Geolocation is not supported.")},loadHeatmap(){const e=[N("response")];console.log(e[0]._rawValue);const t=localStorage.getItem("response")?JSON.parse(localStorage.getItem("response")):[];console.log(t);const o=[],a=[],g=[],r=[];t._rawValue.forEach(u=>{const f={location:new window.google.maps.LatLng(u.latitude,u.longitude),weight:u.stress_level};switch(u.stress_level){case 1:o.push(f);break;case 2:a.push(f);break;case 3:g.push(f);break;case 4:r.push(f);break}});var l=new window.google.maps.visualization.HeatmapLayer({data:o,radius:50,gradient:["rgba(255, 0, 0, 0)","rgba(255, 0, 0, 0.8)"]}),p=new window.google.maps.visualization.HeatmapLayer({data:a,radius:50,gradient:["rgba(255, 100, 0, 0)","rgba(255, 100, 0, 0.8)"]}),b=new window.google.maps.visualization.HeatmapLayer({data:g,radius:50,gradient:["rgba(100, 255, 0, 0)","rgba(100, 255, 0, 0.8)"]}),y=new window.google.maps.visualization.HeatmapLayer({data:r,radius:50,gradient:["rgba(0, 255, 0, 0)","rgba(0, 255, 0, 0.8)"]});this.highstress&&l.setMap(this.map),this.mediumstress&&p.setMap(this.map),this.nostress&&b.setMap(this.map),this.absnostress&&y.setMap(this.map)},loadDefaultLocation(){const e={lat:52.377956,lng:4.89707};this.map.setCenter(e),this.map.setZoom(12)},submitRating(){var e=localStorage.getItem("response")?JSON.parse(localStorage.getItem("response")):[];console.log(e);const t=e._rawValue.length;e._rawValue.unshift({id:t+1,userId:Number(localStorage.getItem("loggedInId")),latitude:this.map.getCenter().lat(),longitude:this.map.getCenter().lng(),stress_level:this.ratingModel,comment:this.reason,geom:'{"type":"Point","coordinates":['+this.map.getCenter().lng()+","+this.map.getCenter().lat()+"]}"}),e._value.unshift({id:t,userId:localStorage.getItem("loggedInId"),latitude:this.map.getCenter().lat(),longitude:this.map.getCenter().lng(),stress_level:this.ratingModel,comment:this.reason,geom:'{"type":"Point","coordinates":['+this.map.getCenter().lng()+","+this.map.getCenter().lat()+"]}"}),localStorage.setItem("response",JSON.stringify(e)),console.log(e),this.ratingModel=0,this.reason=""}},setup(){const e=s(!0),t=s(!0),o=s(!0),a=s(!0),g=s(!0),r=s(!0),l=s(!0),p=s(!1);return V(()=>{e.value=localStorage.getItem("isLoggedIn")==="true",t.value=JSON.parse(localStorage.getItem("constructionMarkings"))||!1,o.value=JSON.parse(localStorage.getItem("sportFacilities"))||!1,a.value=JSON.parse(localStorage.getItem("highstress"))||!1,g.value=JSON.parse(localStorage.getItem("mediumstress"))||!1,r.value=JSON.parse(localStorage.getItem("nostress"))||!1,l.value=JSON.parse(localStorage.getItem("absnostress"))||!1,p.value=JSON.parse(localStorage.getItem("nightMode"))||!1}),{ratingModel:s(0),ratingColors:["red","orange","green","green-9"],icons:["sentiment_very_dissatisfied","sentiment_dissatisfied","sentiment_satisfied","sentiment_very_satisfied"],isLoggedIn:e,constructionMarkings:t,sportFacilities:o,nightMode:p,highstress:a,mediumstress:g,nostress:r,absnostress:l}}},x={class:"map-cont p-5 pb-5"},H={class:"rate-cont p-5 pt-5"};function U(e,t,o,a,g,r){return d(),c(P,{class:"q-pa-none main-page"},{default:i(()=>[m("div",x,[t[2]||(t[2]=m("div",{id:"map",class:"google-map q-card"},null,-1)),n(h,{class:"recenter-btn",color:"primary",icon:"my_location",onClick:r.recenterMap},null,8,["onClick"])]),m("div",H,[a.isLoggedIn?(d(),c(v,{key:0,class:"rate-card"},{default:i(()=>[n(C,null,{default:i(()=>[t[3]||(t[3]=m("div",{class:"text-h6"},"Rate your location",-1)),n(S,{class:"rating-icons",modelValue:a.ratingModel,"onUpdate:modelValue":t[0]||(t[0]=l=>a.ratingModel=l),max:4,color:"grey","color-selected":a.ratingColors,icon:a.icons},null,8,["modelValue","color-selected","icon"]),a.ratingModel?(d(),c(k,{key:0,modelValue:e.reason,"onUpdate:modelValue":t[1]||(t[1]=l=>e.reason=l),label:"Reason",placeholder:"Why did you give this rating?",type:"textarea",rows:"3",optional:""},null,8,["modelValue"])):w("",!0)]),_:1}),a.ratingModel?(d(),c(R,{key:0,align:"right"},{default:i(()=>[n(h,{label:"Submit",color:"primary",onClick:r.submitRating,class:"radius-10"},null,8,["onClick"])]),_:1})):w("",!0)]),_:1})):w("",!0),a.isLoggedIn?w("",!0):(d(),c(v,{key:1},{default:i(()=>[n(C,null,{default:i(()=>[t[4]||(t[4]=m("div",{class:"text-h7"},"Please sign up or log in to be able to rate your location.",-1)),n(J,{class:"q-gutter-sm w-100"},{default:i(()=>[n(h,{label:"Login",color:"primary",class:"col-6",to:"/profile"}),n(h,{label:"Signup",color:"secondary",outline:"",class:"col-6",to:"./signup"})]),_:1})]),_:1})]),_:1}))])]),_:1})}const X=A(z,[["render",U]]);export{X as default};
