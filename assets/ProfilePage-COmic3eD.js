import{a as B,Q as V,_ as A,b as g}from"./vibemap-logo-CDsh_3BC.js";import{Q as i}from"./QItem-Df4rKZi_.js";import{Q as _}from"./QSeparator-BlR_4bAY.js";import{Q as E}from"./QInput-fjGOSg6B.js";import{Q as h,R as S}from"./QBtn-DMCaP-I8.js";import{Q as N}from"./QFile-CB7_l5fe.js";import{Q as y}from"./QIcon-B7Va68bn.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as x,K as r,O as l,L as a,r as n,o as z,V as p,T as b,R as v,k as P,U as D,J as k,W as C,Q as L}from"./index-C7LWaeqp.js";import"./use-dark-DSuK4ZsZ.js";import"./private.use-form-D8QNAGRw.js";const F={setup(){const d=n([{username:"User",userId:1,email:"email@email.com",picture:"../assets/vibemap-logo.svg",token:"password"}]),e=n(null),I=n(!0),o=n(""),u=n(!1),c=n(""),s=n(""),m=n("");z(()=>{I.value=localStorage.getItem("isLoggedIn")==="true",o.value=localStorage.getItem("loggedInId"),m.value=localStorage.getItem("usertoken"),console.log(m.value),Q(m.value)});const Q=async w=>{console.log(w);try{const t=await fetch("https://vibemapbe.com/auth/auth/me",{method:"GET",headers:{Authorization:`Bearer ${w}`}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const f=await t.json();d.value[0]={...d.value[0],email:f.email,userId:f.id}}catch(t){e.value=t.message||"Failed to fetch user data"}},q=async()=>{if(c.value&&s.value){const w={email:c.value,password:s.value};try{const t=await fetch("https://vibemapbe.com/auth/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(t.ok){I.value=!0,localStorage.setItem("isLoggedIn","true");const f=await t.json();console.log(f),m.value=f.access_token,localStorage.setItem("usertoken",f.access_token),this.$router.push("/"),alert("Login successful! Welcome back "+c.value)}else console.error("Login failed",t.responseText),alert("Login failed",t.responseText)}catch(t){console.error("Error during login",t)}}else console.error("Email and password are required"),alert("Email and password are required")},T=()=>{I.value=!1,localStorage.setItem("isLoggedIn","false"),localStorage.setItem("loggedInId",null),c.value="",s.value="",U()},U=()=>{location.reload()};return{login:q,logout:T,editProfile:()=>{u.value=!0,console.log(u.value)},saveProfile:()=>{u.value=!1,console.log(u.value)},profileEdit:u,email:c,password:s,isLoggedIn:I,loggedInId:o,userInfo:d}}},O={class:"text-primary text-center q-pa-md flex flex-center w-100"},R={class:"q-mt-md text-h6"},W={class:"text-caption text-grey"};function J(d,e,I,o,u,c){return r(),x("div",O,[l(B,{class:"w-100"},{default:a(()=>[o.isLoggedIn?p("",!0):(r(),x(b,{key:0},[l(i,{class:"q-pa-md column items-center w-100"},{default:a(()=>[l(V,{size:"72px"},{default:a(()=>e[3]||(e[3]=[v("img",{src:A,alt:"User Avatar"},null,-1)])),_:1}),e[4]||(e[4]=v("div",{class:"q-mt-md text-h6"},"Welcome",-1)),e[5]||(e[5]=v("div",{class:"text-caption text-grey"},"Please login or sign up",-1))]),_:1}),l(_),l(i,{class:"w-100"},{default:a(()=>[l(E,{modelValue:o.email,"onUpdate:modelValue":e[0]||(e[0]=s=>o.email=s),label:"Email",type:"email",filled:"",class:"full-width"},null,8,["modelValue"])]),_:1}),l(i,{class:"w-100"},{default:a(()=>[l(E,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=s=>o.password=s),label:"Password",type:"password",filled:"",class:"full-width"},null,8,["modelValue"])]),_:1}),l(i,{class:"q-gutter-sm w-100"},{default:a(()=>[l(h,{label:"Login",color:"primary",class:"col-6",onClick:o.login},null,8,["onClick"]),l(h,{label:"Signup",color:"secondary",outline:"",class:"col-6",to:"./signup"})]),_:1})],64)),o.isLoggedIn?(r(),x(b,{key:1},[(r(!0),x(b,null,D(o.userInfo,(s,m)=>(r(),k(i,{class:"q-pa-md column items-center w-100",key:m},{default:a(()=>[l(V,{size:"160px"},{default:a(()=>[e[6]||(e[6]=v("img",{src:"{{ userInfo.picture }}",alt:"User Avatar"},null,-1)),o.profileEdit?(r(),k(N,{key:0,class:"picture-edit",modelValue:d.profilePicture,"onUpdate:modelValue":e[2]||(e[2]=Q=>d.profilePicture=Q),filled:"",accept:"image/*","max-files":1,onAdded:d.previewImage},null,8,["modelValue","onAdded"])):p("",!0),o.profileEdit?(r(),k(y,{key:1,class:"picture-edit-icon",name:"edit"})):p("",!0)]),_:1}),v("div",R,C(s.username),1),v("div",W,C(s.email),1)]),_:2},1024))),128)),l(_),o.profileEdit?p("",!0):P((r(),k(i,{key:0,clickable:"",class:"",onClick:o.editProfile},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(y,{name:"edit"})]),_:1}),l(g,null,{default:a(()=>e[7]||(e[7]=[L("Edit profile")])),_:1})]),_:1},8,["onClick"])),[[S]]),o.profileEdit?P((r(),k(i,{key:1,clickable:"",class:"",onClick:o.saveProfile},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(y,{name:"save"})]),_:1}),l(g,null,{default:a(()=>e[8]||(e[8]=[L("Save profile")])),_:1})]),_:1},8,["onClick"])),[[S]]):p("",!0),P((r(),k(i,{clickable:"",class:"text-red",onClick:o.logout},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(y,{name:"logout",color:"red"})]),_:1}),l(g,null,{default:a(()=>e[9]||(e[9]=[L("Logout")])),_:1})]),_:1},8,["onClick"])),[[S]])],64)):p("",!0)]),_:1})])}const se=j(F,[["render",J]]);export{se as default};
