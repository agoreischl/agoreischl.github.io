import{u as V,b as x,Q as i}from"./QBtn-D7F4cWr6.js";import{Q as L}from"./QRating-yHzveZDl.js";import{Q as w}from"./QCheckbox-D-tV-lIq.js";import{Q as I}from"./QInput-CV5OlRDe.js";import{Q as h,a as C}from"./QCard-CDkCLuDm.js";import{c as U,a as P,h as Q,J as g,K as u,L as m,r as f,o as N,R as s,T as E,W as p,Q as r,S}from"./index-DS6vRXNd.js";import{h as A}from"./QIcon-Dh3R34bv.js";import{Q as M}from"./QItem-8PyDlN_t.js";import{Q as b}from"./QToggle-CBb7Tcv7.js";import{Q as F}from"./QPage-ChUy4CMy.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./private.use-form-Crf19nNF.js";import"./use-checkbox-DHNEinOy.js";import"./use-dark-Bu-aqF6F.js";const O=U({name:"QCardActions",props:{...V,vertical:Boolean},setup(t,{slots:e}){const d=x(t),o=P(()=>`q-card__actions ${d.value} q-card__actions--${t.vertical===!0?"vert column":"horiz row"}`);return()=>Q("div",{class:o.value},A(e.default))}}),R={data(){return{map:null,userMarker:null,currentCard:1,showIntro:!0}},mounted(){this.loadGoogleMaps()},methods:{loadGoogleMaps(){if(window.google&&window.google.maps){this.initMap();return}const t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCa6szZqcobw9AEf8KiqXUDpAoLgSR6v7A",t.async=!0,t.defer=!0,t.onload=()=>this.initMap(),document.head.appendChild(t)},nextCard(){this.currentCard<6&&this.currentCard++},previousCard(){this.currentCard<7&&this.currentCard--},closeCards(){this.currentCard=1,this.showIntro=!1},initMap(){if(!navigator.geolocation)return console.error("Geolocation is not supported by this browser."),this.loadDefaultLocation();this.map=new window.google.maps.Map(document.getElementById("map"),{center:{lat:52.377956,lng:4.89707},zoom:12,mapTypeControl:!1,zoomControl:!1,cameraControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,gestureHandling:"greedy"}),this.loadHeatmap(),this.trackUserLocation()},trackUserLocation(){let t=!0;navigator.geolocation.watchPosition(e=>{const d={lat:e.coords.latitude,lng:e.coords.longitude};t&&(this.map.setCenter(d),this.map.setZoom(15),t=!1),this.userMarker?this.userMarker.setPosition(d):this.userMarker=new window.google.maps.Marker({position:d,map:this.map,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff"}})},()=>{console.error("User denied Geolocation."),this.loadDefaultLocation()},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},recenterMap(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const e={lat:t.coords.latitude,lng:t.coords.longitude};this.map.setCenter(e),this.map.setZoom(15),this.userMarker||(this.userMarker=new window.google.maps.Marker({position:e,map:this.map,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff"}}))},()=>{console.error("Unable to retrieve location.")}):console.error("Geolocation is not supported.")},async loadHeatmap(){var t=[];try{if(t=await fetch("https://vibemapbe.com/location/location/locations/"),!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);t=await t.json(),console.log(t)}catch(n){console.error("Error fetching data:",n)}console.log(t);const e=[],d=[],o=[],c=[];t.forEach(n=>{const v={location:new window.google.maps.LatLng(n.latitude,n.longitude),weight:n.stress_level};n.stress_level>=.5&&n.stress_level<1.5?e.push(v):n.stress_level>=1.5&&n.stress_level<2.5?d.push(v):n.stress_level>=2.5&&n.stress_level<3.5?o.push(v):n.stress_level>=3.5&&n.stress_level<=4.5?c.push(v):console.error("Invalid stress level:",n.stress_level)});var l=new window.google.maps.visualization.HeatmapLayer({data:e,radius:50,gradient:["rgba(255, 0, 0, 0)","rgba(255, 0, 0, 0.8)"]}),a=new window.google.maps.visualization.HeatmapLayer({data:d,radius:50,gradient:["rgba(255, 100, 0, 0)","rgba(255, 100, 0, 0.8)"]}),y=new window.google.maps.visualization.HeatmapLayer({data:o,radius:50,gradient:["rgba(100, 255, 0, 0)","rgba(100, 255, 0, 0.8)"]}),k=new window.google.maps.visualization.HeatmapLayer({data:c,radius:50,gradient:["rgba(0, 255, 0, 0)","rgba(0, 255, 0, 0.8)"]});this.highstress&&l.setMap(this.map),this.mediumstress&&a.setMap(this.map),this.nostress&&y.setMap(this.map),this.absnostress&&k.setMap(this.map)},loadDefaultLocation(){const t={lat:52.377956,lng:4.89707};this.map.setCenter(t),this.map.setZoom(12)},getMarkerLatLng(t){if(!t||!t.getPosition)throw new Error("Invalid marker object provided.");const e=t.getPosition();return{lat:e.lat(),lng:e.lng()}},async submitRating(){if(!this.userMarker){console.error("User marker is not available.");return}const t=localStorage.getItem("usertoken"),e=this.getMarkerLatLng(this.userMarker);console.log("Latitude:",e.lat),console.log("Longitude:",e.lng),console.log(e);const d={latitude:e.lat,longitude:e.lng,comment:this.reason?this.reason:null,stress_level:this.ratingModel,construction:this.construction,noise:this.noise,crowd:this.crowd};try{const o=await fetch("https://vibemapbe.com/location/location/locations/",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const c=await o.json();console.log("Review submitted successfully:",c),this.loadHeatmap()}catch(o){console.error("Error submitting review:",o),alert("Failed to submit review. Please try again.")}finally{this.ratingModel=0,this.reason=""}}},setup(){const t=f(),e=f(),d=f(),o=f(),c=f(),l=f(),a=f(),y=f();N(()=>{t.value=localStorage.getItem("isLoggedIn")==="true",e.value=JSON.parse(localStorage.getItem("constructionMarkings")),d.value=JSON.parse(localStorage.getItem("sportFacilities")),o.value=JSON.parse(localStorage.getItem("highstress")),c.value=JSON.parse(localStorage.getItem("mediumstress")),l.value=JSON.parse(localStorage.getItem("nostress")),a.value=JSON.parse(localStorage.getItem("absnostress")),y.value=JSON.parse(localStorage.getItem("nightMode"))});const k=(n,v)=>{localStorage.setItem(n,JSON.stringify(v))};return{ratingModel:f(0),ratingColors:["red","orange","green","green-9"],icons:["sentiment_very_dissatisfied","sentiment_dissatisfied","sentiment_satisfied","sentiment_very_satisfied"],noise:f(!1),crowd:f(!1),construction:f(!1),isLoggedIn:t,constructionMarkings:e,sportFacilities:d,nightMode:y,highstress:o,mediumstress:c,nostress:l,absnostress:a,saveSetting:k}}},q={class:"map-cont p-5 pb-5"},z={class:"rate-cont p-5 pt-5"},J={key:0,class:"intro-cont p-5 pt-5 bg-primary"},T={class:"btn-cnt"},B={class:"btn-cnt"},D={class:"pref-cont"},j={class:"btn-cnt"},W={class:"btn-cnt"},G={class:"text-body1"},_={class:"btn-cnt"};function Z(t,e,d,o,c,l){return u(),g(F,{class:"q-pa-none main-page"},{default:m(()=>[s("div",q,[e[17]||(e[17]=s("div",{id:"map",class:"google-map q-card"},null,-1)),r(i,{class:"recenter-btn",color:"primary",icon:"my_location",onClick:l.recenterMap},null,8,["onClick"])]),s("div",z,[o.isLoggedIn?(u(),g(h,{key:0,class:"rate-card"},{default:m(()=>[r(C,null,{default:m(()=>[e[18]||(e[18]=s("div",{class:"text-h6"},"Rate your location",-1)),r(L,{class:"rating-icons",modelValue:o.ratingModel,"onUpdate:modelValue":e[0]||(e[0]=a=>o.ratingModel=a),max:4,color:"grey","color-selected":o.ratingColors,icon:o.icons},null,8,["modelValue","color-selected","icon"]),o.ratingModel?(u(),g(w,{key:0,class:"checkbox noise",modelValue:o.noise,"onUpdate:modelValue":e[1]||(e[1]=a=>o.noise=a),"checked-icon":"campaign","unchecked-icon":"volume_down_alt","indeterminate-icon":"sound_detection_loud_sound"},null,8,["modelValue"])):p("",!0),o.ratingModel?(u(),g(w,{key:1,class:"checkbox crowd",modelValue:o.crowd,"onUpdate:modelValue":e[2]||(e[2]=a=>o.crowd=a),"checked-icon":"groups","unchecked-icon":"group_off","indeterminate-icon":"groups_2"},null,8,["modelValue"])):p("",!0),o.ratingModel?(u(),g(w,{key:2,class:"checkbox construction",modelValue:o.construction,"onUpdate:modelValue":e[3]||(e[3]=a=>o.construction=a),"checked-icon":"construction","unchecked-icon":"build_circle","indeterminate-icon":"construction"},null,8,["modelValue"])):p("",!0),o.ratingModel?(u(),g(I,{key:3,modelValue:t.reason,"onUpdate:modelValue":e[4]||(e[4]=a=>t.reason=a),label:"Reason",placeholder:"Why did you give this rating?",type:"textarea",rows:"1",optional:""},null,8,["modelValue"])):p("",!0)]),_:1}),o.ratingModel?(u(),g(O,{key:0,align:"right"},{default:m(()=>[r(i,{label:"Submit",color:"primary",onClick:l.submitRating,class:"radius-10"},null,8,["onClick"])]),_:1})):p("",!0)]),_:1})):p("",!0),o.isLoggedIn?p("",!0):(u(),g(h,{key:1},{default:m(()=>[r(C,null,{default:m(()=>[e[19]||(e[19]=s("div",{class:"text-h7"},"Please sign up or log in to be able to rate your location.",-1)),r(M,{class:"q-gutter-sm w-100"},{default:m(()=>[r(i,{label:"Login",color:"primary",class:"col-6",to:"/profile"}),r(i,{label:"Signup",color:"secondary",outline:"",class:"col-6",to:"./signup"})]),_:1})]),_:1})]),_:1}))]),!o.isLoggedIn&&c.showIntro?(u(),E("div",J,[c.currentCard===1?(u(),g(h,{key:0},{default:m(()=>[e[20]||(e[20]=s("div",{class:"text-h5 font-atkinson-bold"},"Welcome to VibeMap",-1)),e[21]||(e[21]=s("div",{class:"text-body1"},[s("p",null,"Find your calm in the urban jungle. VibeMap is a community‐driven guide that shows you where to find relaxing spots and avoid stress in your city."),s("p",null,"By rating places on a 1–4 scale using smileys and sharing feedback on ambiance, noise, and environment – along with your personal comments – you help build a living map that reflects the true vibe of your urban surroundings."),s("p",null,"Your input helps everyone navigate towards more relaxing experiences.")],-1)),s("div",T,[r(i,{label:"Skip",color:"secondary",onClick:l.closeCards,class:"radius-10 left-btn"},null,8,["onClick"]),r(i,{label:"Next",color:"primary",onClick:l.nextCard,class:"radius-10 right-btn"},null,8,["onClick"])])]),_:1})):p("",!0),c.currentCard===2?(u(),g(h,{key:1},{default:m(()=>[e[22]||(e[22]=s("div",{class:"text-h5 font-atkinson-bold"},"Understanding Urban Stress",-1)),e[23]||(e[23]=s("div",{class:"text-body1"},[s("p",null,"City life is full of contrasts. For some, the hum of construction or crowded streets can be overwhelming, while for others, a touch of nature or active leisure can provide much-needed relief."),s("p",null,"We want to understand how these factors affect you personally – so that VibeMap can better guide you to the environments that match your unique needs."),s("p",null,"VibeMap is a project by the students of the University of Amsterdam. It is a part of the Social Complexity and Designing with Data course, which aims to promote and increase urban mental health.")],-1)),s("div",B,[r(i,{label:"Previous",color:"secondary",onClick:l.previousCard,class:"radius-10 left-btn"},null,8,["onClick"]),r(i,{label:"Next",color:"primary",onClick:l.nextCard,class:"radius-10 right-btn"},null,8,["onClick"])])]),_:1})):p("",!0),c.currentCard===3?(u(),g(h,{key:2},{default:m(()=>[e[24]||(e[24]=s("div",{class:"text-h5 font-atkinson-bold"},"Preferences",-1)),e[25]||(e[25]=s("div",{class:"text-body1"},[s("p",null,"You can select what you would like to see on your map. You can modify these later in the Settings page.")],-1)),s("div",D,[r(b,{modelValue:o.constructionMarkings,"onUpdate:modelValue":[e[5]||(e[5]=a=>o.constructionMarkings=a),e[6]||(e[6]=a=>o.saveSetting("constructionMarkings",o.constructionMarkings))],label:"Enable Construction Markings"},null,8,["modelValue"]),r(b,{modelValue:o.sportFacilities,"onUpdate:modelValue":[e[7]||(e[7]=a=>o.sportFacilities=a),e[8]||(e[8]=a=>o.saveSetting("sportFacilities",o.sportFacilities))],label:"Enable Sport Facility Markings"},null,8,["modelValue"]),r(b,{modelValue:o.highstress,"onUpdate:modelValue":[e[9]||(e[9]=a=>o.highstress=a),e[10]||(e[10]=a=>o.saveSetting("highstress",o.highstress))],label:"Show High-Stress areas"},null,8,["modelValue"]),r(b,{modelValue:o.mediumstress,"onUpdate:modelValue":[e[11]||(e[11]=a=>o.mediumstress=a),e[12]||(e[12]=a=>o.saveSetting("mediumstress",o.mediumstress))],label:"Show Medium-Stress areas"},null,8,["modelValue"]),r(b,{modelValue:o.nostress,"onUpdate:modelValue":[e[13]||(e[13]=a=>o.nostress=a),e[14]||(e[14]=a=>o.saveSetting("nostress",o.nostress))],label:"Show No-Stress areas"},null,8,["modelValue"]),r(b,{modelValue:o.absnostress,"onUpdate:modelValue":[e[15]||(e[15]=a=>o.absnostress=a),e[16]||(e[16]=a=>o.saveSetting("absnostress",o.absnostress))],label:"Show Absolutely No-Stress areas"},null,8,["modelValue"])]),s("div",j,[r(i,{label:"Previous",color:"secondary",onClick:l.previousCard,class:"radius-10 left-btn"},null,8,["onClick"]),r(i,{label:"Next",color:"primary",onClick:l.nextCard,class:"radius-10 right-btn"},null,8,["onClick"])])]),_:1})):p("",!0),c.currentCard===4?(u(),g(h,{key:3},{default:m(()=>[e[26]||(e[26]=s("div",{class:"text-h5 font-atkinson-bold"},"How VibeMap Works",-1)),e[27]||(e[27]=s("div",{class:"text-body1"},[s("p",null,"1. Rate your current location by selecting a smiley that best represents your stress level."),s("p",null,"2. Add a comment to share your thoughts on the location. Optionally, select the cause of your rating using the available options."),s("p",null,"3. Use the map to find relaxing spots and avoid stress in your city."),s("p",null,"Every rating and comment builds a detailed, crowdsourced map to help everyone navigate toward a more relaxed city.")],-1)),s("div",W,[r(i,{label:"Previous",color:"secondary",onClick:l.previousCard,class:"radius-10 left-btn"},null,8,["onClick"]),r(i,{label:"Next",color:"primary",onClick:l.nextCard,class:"radius-10 right-btn"},null,8,["onClick"])])]),_:1})):p("",!0),c.currentCard===5?(u(),g(h,{key:4},{default:m(()=>[e[31]||(e[31]=s("div",{class:"text-h5 font-atkinson-bold"},"Contact us",-1)),s("div",G,[s("p",null,[e[28]||(e[28]=S("For questions or feedback, please contact us at using the ")),r(i,{to:"/feedback",label:"Feedback",flat:"",color:"primary"}),e[29]||(e[29]=S(" page."))]),e[30]||(e[30]=s("p",null,"Sign up or log in to start rating your location and help others find their calm.",-1))]),s("div",null,[r(M,{class:"q-gutter-sm w-100"},{default:m(()=>[r(i,{label:"Login",color:"primary",class:"col-6",to:"/profile"}),r(i,{label:"Signup",color:"secondary",outline:"",class:"col-6",to:"./signup"})]),_:1})]),s("div",_,[r(i,{label:"Previous",color:"secondary",onClick:l.previousCard,class:"radius-10 left-btn"},null,8,["onClick"]),r(i,{label:"Get started!",color:"primary",onClick:l.closeCards,class:"radius-10 right-btn"},null,8,["onClick"])])]),_:1})):p("",!0)])):p("",!0)]),_:1})}const ce=H(R,[["render",Z]]);export{ce as default};
